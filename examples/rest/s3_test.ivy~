#lang ivy1.7

include service_2

action get (bucket : string, key : string) = {
    var req : _GetObjectRequest;
    req._Bucket_ := bucket;
    req._Key_ := key;
    call _GetObject.request(req);
}

action put (bucket : string, key : string, data : blob) = {
    var req : _PutObjectRequest;
    req._Bucket_ := bucket;
    req._Key_ := key;
    req._Body_ := req._Body_.append(data);
    call _PutObject.request(req);
}

specification {

    relation present(B:string, K:string)
    function contents(B:string, K:string) : blob

    var the_bucket : string
    var the_key : string
    
    
    after init {
        present(B,K) := false;
        the_bucket := "kenmcm-tmp1";
        the_key := "testkey";
    }
    
    before get {
        assert bucket = the_bucket;
        assert key = the_key;
        assert present(bucket,key);
    }
        
    before _GetObject.response_GetObjectOutput(res:_GetObjectOutput) {
        require present(the_bucket,the_key);
        require contents(the_bucket,the_key) = res._Body_;
    }

    before put {
        assert bucket = the_bucket;
        assert key = the_key;
        present(bucket,key) := true;
        contents(bucket,key) := data;
    }

}


export get
export put
import _GetObject.response_GetObjectOutput
import _PutObject.response_PutObjectOutput

interpret string -> strbv[4]

attribute cppstd = cpp11

